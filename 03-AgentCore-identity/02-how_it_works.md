# Bedrock AgentCore Identity 작동 방식

## 소개

AgentCore Identity는 AI 에이전트 배포의 근본적인 과제를 해결합니다: 보안이나 사용자 경험을 손상시키지 않으면서 에이전트가 여러 서비스에 걸쳐 사용자별 데이터에 안전하게 액세스할 수 있도록 하는 것입니다. 기존 접근 방식은 세밀한 제어 없이 광범위한 액세스 자격 증명을 사용하거나 각 서비스 통합에 대해 명시적인 사용자 동의를 요구합니다(사용자 경험 저하). AgentCore Identity는 제로 트러스트 보안 원칙과 위임 기반 인증을 구현하는 포괄적인 워크플로를 통해 이를 해결합니다.

이 서비스는 가장이 아닌 위임 원칙에 따라 작동합니다. 에이전트가 사용자 자격 증명을 직접 사용하는 대신 검증 가능한 사용자 컨텍스트를 전달하면서 자신으로 인증합니다. 이 접근 방식은 세밀한 액세스 제어, 포괄적인 감사 추적 및 사용자 액세스와 독립적으로 에이전트 액세스를 취소할 수 있는 기능을 가능하게 합니다. 워크플로는 개발자에게 간단한 인터페이스를 제공하면서 여러 신뢰 도메인에 걸쳐 복잡한 인증과 권한 부여를 조율합니다.

핵심적으로 AgentCore Identity는 적절한 보안 경계를 유지하면서 에이전트가 리소스에 액세스할 수 있는 안전한 인증 메커니즘을 제공합니다. 이를 통해 서비스가 적절한 권한 부여 결정을 내릴 수 있으며, 단일 워크플로 내에서 내부 캘린더 시스템과 Google Calendar와 같은 외부 서비스에 액세스할 수 있는 교차 서비스 에이전트와 같은 정교한 사용 사례를 지원합니다.

다음 다이어그램은 사용자, 애플리케이션, 에이전트, AWS 리소스 및 타사 서비스가 안전하게 상호 작용하는 방법을 보여주는 완전한 AgentCore Identity 워크플로를 보여줍니다:

<div style="text-align:center">
    <img src="images/how_it_works.png" width="100%"/>
</div>

AgentCore Identity 워크플로는 다음 단계로 구성됩니다:

**사용자가 OAuth/OIDC로 로그인하고 애플리케이션에 토큰 전달** — 사용자는 조직의 기존 ID 공급자(Auth0, Cognito 또는 기타 OIDC 호환 시스템 등)를 통해 인증하고 액세스 토큰 또는 ID 토큰을 받습니다. 이 토큰에는 사용자의 ID 정보와 승인된 범위가 포함되어 전체 워크플로에 대한 사용자의 ID 컨텍스트를 설정합니다. 애플리케이션은 이 토큰을 받고 에이전트에 대한 요청을 승인하는 데 사용합니다.

**사용자 대면 애플리케이션이 사용자 로그인 처리** — 애플리케이션은 사용자의 인증 토큰을 검증하고 안전한 세션을 설정합니다. 이 단계는 사용자가 적절히 인증되고 AI 에이전트 호출 기능을 포함한 애플리케이션 기능에 액세스할 권한이 있는지 확인합니다. 애플리케이션은 개인화 및 액세스 제어 목적으로 토큰에서 사용자 ID 정보를 추출할 수도 있습니다.

**사용자가 AI 에이전트의 리소스 액세스 요청** — 사용자가 에이전트 상호 작용을 시작하면 애플리케이션은 사용자를 대신하여 AI 에이전트를 호출하는 요청을 합니다. 이 요청에는 사용자의 인증 토큰과 에이전트가 수행해야 할 작업에 대한 필요한 컨텍스트가 포함됩니다. 애플리케이션은 프록시 역할을 하여 사용자의 ID 컨텍스트를 유지하면서 사용자의 인증된 요청을 에이전트 인프라로 전달합니다.

**사용자 대면 애플리케이션이 사용자 토큰으로 에이전트 서비스에 요청** — Bedrock AgentCore 서비스는 요청을 받고 구성된 권한 부여 정책에 대해 사용자의 토큰을 검증합니다. 이 검증에는 토큰의 서명, 만료, 발급자, 대상 및 필요한 범위 확인이 포함됩니다. 서비스는 사용자가 특정 에이전트를 호출할 필요한 권한이 있고 요청이 진행하기 전에 모든 보안 요구 사항을 충족하는지 확인합니다.

**Bedrock AgentCore가 Agent Credential Provider에서 워크로드 액세스 토큰 요청** — 에이전트 서비스는 워크로드 액세스 토큰(기술적으로 워크로드 액세스 토큰)을 얻기 위해 토큰 교환 프로세스를 시작합니다. 에이전트 서비스는 사용자의 토큰을 AgentCore Identity의 토큰 교환 API에 제출합니다. 요청은 IAM 자격 증명으로 승인됩니다. 이를 통해 신뢰 체인을 유지하고 권한 부여 결정을 지원하면서 다운스트림 리소스에 대한 안전하고 감사 가능한 액세스를 가능하게 합니다.

**AgentCore Identity가 사용자 토큰을 검증하고 워크로드 액세스 토큰 발급** — AgentCore Identity는 사용자 토큰의 서명, 만료, 발급자, 대상 및 범위를 검증합니다. 그런 다음 워크로드 액세스 토큰을 반환합니다. 이를 통해 신뢰 체인을 유지하면서 다운스트림 리소스에 대한 안전하고 감사 가능한 액세스를 가능하게 합니다. AgentCore Identity는 에이전트의 ID 확인, 사용자의 원래 OAuth/OIDC 토큰 서명 및 클레임 검증, 에이전트가 사용자를 대신하여 요청된 리소스에 액세스할 권한이 있는지 확인을 포함하여 요청에 대한 포괄적인 제로 트러스트 검증을 수행합니다. 이 검증은 소스나 이전 신뢰 관계에 관계없이 발생하여 모든 요청이 독립적으로 인증되고 승인되도록 합니다.

**AI 에이전트 애플리케이션이 에이전트 호출** — 에이전트 애플리케이션은 워크로드 액세스 토큰을 받고 요청된 작업 실행을 시작합니다. 에이전트는 이제 자신의 ID와 대신 행동하는 사용자에 대한 검증 가능한 증명으로 작동할 수 있습니다. 이를 통해 에이전트는 원래 사용자에게 작업의 완전한 추적 가능성을 유지하면서 다양한 도구와 리소스에 인증된 요청을 할 수 있습니다.

**에이전트가 리소스 액세스 토큰 요청** — 에이전트가 AWS 리소스와 타사 서비스(Google Calendar, Slack 또는 내부 API 등)에 액세스해야 할 때 AgentCore Credential Provider에서 적절한 자격 증명을 요청합니다. 에이전트는 자신의 ID와 권한 부여의 증명으로 워크로드 액세스 토큰을 제시합니다. 시스템은 이 토큰을 검증하고 구성된 정책과 사용자 동의를 기반으로 에이전트가 액세스할 수 있는 리소스를 결정합니다. AgentCore Identity는 요청된 사용자 ID와 리소스에 대한 기존 토큰이 있을 수 있으며, 이 경우 리소스 액세스 토큰을 반환합니다.

**Amazon Bedrock AgentCore Identity가 리소스와 사용자 인증 요청** — AgentCore Identity가 토큰 볼트에 요청된 리소스에 대한 기존 액세스 토큰이 없는 경우 제공된 URL에서 사용자 동의가 필요하다는 응답을 반환합니다. 명시적인 사용자 동의가 필요한 리소스(Google Calendar과 같은 타사 서비스)의 경우 시스템은 사용자 인증 플로우를 시작해야 할 수 있습니다. 이는 일반적으로 사용자를 리소스 공급자의 권한 부여 서버(Google의 OAuth 2.0 엔드포인트 또는 Microsoft의 Azure AD 등)로 리디렉션하여 에이전트가 자신의 데이터에 액세스할 수 있는 권한을 부여하는 것을 포함합니다. 이 단계는 사용자가 에이전트가 자신을 대신하여 액세스할 수 있는 리소스에 대한 제어를 유지하고 OAuth 2.0 클라이언트 자격 증명 부여(기계 간) 및 OAuth 2.0 권한 부여 코드 부여(사용자 위임 액세스) 플로우를 모두 지원하도록 합니다.

**Bedrock AgentCore가 사용자 인증 요청** — 에이전트 서비스는 요청된 권한 부여 URL을 전달하여 사용자 대면 애플리케이션에 응답을 반환합니다.

**사용자 대면 애플리케이션이 인증 및 동의 프롬프트 표시** — 사용자에게 자격 증명을 입력하고 에이전트와 데이터를 공유하라는 메시지가 표시됩니다.

**사용자가 데이터 공유에 동의** — 사용자가 타사 공급자의 동의 프롬프트를 수락합니다.

**타사 리소스가 사용자 자격 증명을 검증하고 리소스 액세스 토큰 발급** — 타사 서비스 공급자(Google, Microsoft 또는 Salesforce 등)가 사용자의 자격 증명과 동의를 검증한 다음 에이전트가 사용할 액세스 토큰을 발급합니다. 이 토큰은 일반적으로 사용자가 에이전트에 명시적으로 부여한 권한으로만 범위가 지정되어 최소 권한 액세스 원칙을 따릅니다. 이 권한 부여 요청의 콜백 URL은 공급자 응답을 처리하고 요청된 리소스에 대한 액세스 토큰을 수집하는 AgentCore Identity 서비스 엔드포인트입니다.

**AgentCore Identity가 리소스 액세스 토큰을 저장하고 반환** — AgentCore Identity는 에이전트의 요청에 대한 응답으로 리소스 액세스 토큰을 반환합니다. 서비스는 또한 특정 에이전트 ID와 사용자 ID 조합과 연결하여 향후 사용을 위해 토큰 볼트에 리소스 액세스 토큰을 안전하게 저장합니다. 이를 통해 후속 요청이 반복적인 사용자 인증을 요구하지 않고 토큰을 재사용할 수 있어 보안을 유지하면서 사용자 경험을 개선합니다. 토큰은 암호화되고 액세스 제어되어 무단 검색을 방지합니다. 토큰 볼트는 제로 트러스트 원칙에 따라 작동하여 자격 증명이 원래 획득한 정확한 에이전트와 사용자 조합에 의해서만 액세스될 수 있도록 합니다. 이는 서로 다른 에이전트나 사용자 간의 무단 교차 액세스를 방지합니다.

**에이전트가 리소스에서 데이터 요청** — 리소스별 액세스 토큰을 사용하여 에이전트는 타사 리소스에서 데이터를 읽거나 쓰기 위해 API 호출을 합니다. 에이전트는 사용자가 부여한 권한과 리소스 공급자 API에서 정의한 기능의 범위 내에서 작동합니다. 모든 작업은 감사 및 보안 목적으로 에이전트의 ID가 명확히 설정된 상태로 수행됩니다.

**타사 리소스가 리소스 액세스 토큰을 검증하고 데이터 반환** — 타사 서비스는 에이전트가 제공한 액세스 토큰을 검증하여 유효하고 만료되지 않았으며 요청된 작업에 필요한 범위를 가지고 있는지 확인합니다. 성공적인 검증 후 리소스는 요청된 데이터를 반환하거나 요청된 작업의 완료를 확인합니다. 이 검증은 적절한 사용자 동의를 받은 승인된 에이전트만 보호된 리소스에 액세스할 수 있도록 합니다.

**AI 에이전트 애플리케이션이 응답 조합** — 에이전트는 AWS 리소스와 타사 서비스에서 받은 데이터를 처리하고 추가 로직과 컨텍스트와 결합하여 포괄적인 응답을 만듭니다. 에이전트는 사용자의 원래 요청에 대한 컨텍스트를 유지하고 액세스된 리소스의 데이터를 통합하면서 응답이 사용자의 요구를 해결하도록 합니다.

**AgentCore가 애플리케이션에 응답 반환** — 에이전트는 완료된 응답을 사용자 대면 애플리케이션으로 다시 보냅니다. 이 응답에는 에이전트의 작업 결과, AWS 리소스와 타사 서비스에서 검색된 모든 데이터, 완료된 작업의 확인이 포함됩니다. 응답은 보안 컨텍스트를 유지하고 사용자를 대신하여 수행된 작업에 대한 감사 정보를 제공합니다.

**사용자 대면 애플리케이션이 응답 표시** — 애플리케이션은 텍스트, 구조화된 데이터 또는 완료된 작업의 확인 등 적절한 형식으로 에이전트의 응답을 사용자에게 제시합니다. 사용자는 요청의 결과를 보고 에이전트가 다양한 리소스에 대한 승인된 액세스를 사용하여 무엇을 달성했는지 이해할 수 있습니다.

**프로세스 완료(완료)** — 모든 토큰이 적절히 관리되고 감사 로그가 기록되며 사용자의 요청이 충족된 상태로 워크플로가 완료됩니다. 시스템은 여러 서비스와 플랫폼에 걸쳐 데이터에 액세스하고 조작하기 위해 AI 에이전트를 활용하려는 사용자에게 원활한 경험을 제공하면서 프로세스 전반에 걸쳐 보안을 유지합니다.

이 워크플로는 AgentCore Credential Provider를 기존 인증 접근 방식과 구별하는 몇 가지 주요 기술 원칙을 기반으로 구축됩니다. 서비스는 소스나 이전 신뢰 관계에 관계없이 모든 요청이 검증되는 제로 트러스트 보안을 구현합니다. 가장이 아닌 위임 기반 인증을 사용하여 에이전트가 사용자 컨텍스트를 전달하면서 항상 자신으로 인증하도록 합니다. 서비스는 에이전트 간 도구 통신을 위한 표준 프로토콜을 지원하는 MCP(Model Context Protocol) 호환입니다. 마지막으로 일관된 보안 표준을 유지하면서 에이전트가 AWS, 다른 클라우드 공급자 및 온프레미스 환경에서 작동할 수 있도록 하는 크로스 플랫폼 지원을 제공합니다. 